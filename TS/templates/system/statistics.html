{% extends "ts_index.html" %}
{% load static %}
{% block content %}
<section id="statistics-content" class="container-fluid">
  <div class="d-flex justify-content-between align-items-center my-3">
    <h4><i class="fas fa-chart-bar me-2"></i><b>STATISTICS</b></h4>
    <div class="d-flex gap-3 align-items-center">
      <select id="timeframe" class="form-select" style="width: 150px;">
        <option value="day">Today</option>
        <option value="week">This Week</option>
        <option value="month">This Month</option>
        <option value="semester">This Semester</option>
      </select>
      <select id="chartType" class="form-select" style="width: 150px;">
        <option value="doughnut">Pie Chart</option>
        <option value="bar">Bar Chart</option>
      </select>
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="autoRefreshToggle" checked>
        <label class="form-check-label" for="autoRefreshToggle">Auto Refresh</label>
      </div>
      <button id="manualRefreshBtn" class="btn btn-outline-primary" disabled>
        <i class="fas fa-sync-alt"></i> Refresh
      </button>
    </div>
  </div>

  <div class="text-end mb-3">
    <small id="last-updated" class="text-muted"></small>
  </div>

  <div class="row gy-4">
    <!-- Violation Statistics -->
    <div class="col-lg-6">
      <div class="card p-4 shadow-sm">
        <h5 class="text-center mb-3">Violation Statistics</h5>
        <div class="d-flex justify-content-center align-items-center" style="height: 300px;">
          <canvas id="violationChart" style="max-width: 90%; max-height: 100%;"></canvas>
        </div>
        <div class="text-center my-3">
          <strong>Total Violators: </strong><span id="violator-count" style="color:#19387E; font-size: 1.5rem;">0</span>
        </div>
        <table class="table table-sm text-center">
          <thead><tr><th>Violation Type</th><th>Count</th></tr></thead>
          <tbody id="violation-details-body"></tbody>
        </table>
      </div>
    </div>

    <!-- User Statistics -->
    <div class="col-lg-6">
      <div class="card p-4 shadow-sm">
        <h5 class="text-center mb-3">User Statistics</h5>
        <div class="row text-center mb-4">
          <div class="col">
            <i class="fas fa-ticket-alt text-primary"></i><br>
            <strong>Tickets Issued</strong><br>
            <span id="my-tickets" style="color:#19387E; font-size: 1.5rem;">0</span>
          </div>
          <div class="col">
            <i class="fas fa-exclamation-triangle text-warning"></i><br>
            <strong>IDs Not Claimed</strong><br>
            <span id="my-ids-not-claimed" style="color:#19387E; font-size: 1.5rem;">0</span>
          </div>
          <div class="col">
            <i class="fas fa-id-card text-success"></i><br>
            <strong>IDs Returned</strong><br>
            <span id="my-ids-returned" style="color:#19387E; font-size: 1.5rem;">0</span>
          </div>
        </div>
        <h6 class="text-center mb-2">Current User: <span id="current-user-name">Loading...</span></h6>
        <table class="table table-sm text-center">
          <thead><tr><th>Violation Type</th><th>Count</th></tr></thead>
          <tbody id="my-violation-details"></tbody>
        </table>
        
        <h6 class="text-center mt-4 mb-2">All Users</h6>
        <div class="table-responsive">
          <table class="table table-sm text-center">
            <thead><tr><th>User</th><th>Total Tickets</th><th>ID Violations</th><th>Uniform Violations</th><th>Dress Code Violations</th></tr></thead>
            <tbody id="all-users-stats"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
