{% extends "tsg_index.html" %}
{% load static %}

{% block content %}
  <div id="ticket-details-content" data-ticket-id="{{ ticket.ticket_id }}">
    <div class="section-header d-flex justify-content-between align-items-center mb-4" style="background-color: transparent;  box-shadow: none;">
      <div class="title-section">
        <i class="fas fa-ticket-alt me-2"></i>TICKET DETAILS
      </div>
      <a class="btn btn-outline-primary" href="{% url 'ts_guard:Dashboard' %}" role="button" style="padding: 4px 12px; width: auto;">
        <i class="fas fa-arrow-left"></i> Go Back
      </a>
    </div>

    <div class="container-fluid" style="max-width: 1000px;">
      <div class="row g-0 mb-3">
        <!-- Ticket Header -->
        <div class="col-12 d-flex align-items-center ps-4">
          <h2 class="me-3 mb-0"><b>Ticket #{{ ticket.ticket_id }}</b></h2>
          <span {% if ticket.ticket_status != 1 and ticket.ticket_status != 2 %} class="status-pending"
                {% elif ticket.ticket_status != 0 and ticket.ticket_status != 2 %} class="status-resolved"
                {% else %} class="status-cleared" {% endif %}>
              {% if ticket.ticket_status != 1 and ticket.ticket_status != 2 %} Pending
              {% elif ticket.ticket_status != 0 and ticket.ticket_status != 2 %} Resolved 
              {% else %} Cleared {% endif %}
          </span>
        </div>
      </div>

      <!-- Two Column Layout -->
      <div class="row">
        <!-- Column 1: Photo Proof -->
        <div class="col-md-4 pe-0">
          <div class="photo-proof-container p-3 h-100">
            <h5 class="mb-3"><b>Photo Proof</b></h5>
            <div class="text-center mt-3">
              <div id="photoContainer" class="mb-3">
                <img id="ticketPhoto" style="max-width: 100%; max-height: 300px; object-fit: contain; display: none;" alt="Ticket photo proof">
                <p id="noPhotoMessage" style="display: none;">No photo available</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Column 2: Student Details & Ticket Details -->
        <div class="col-md-8 ps-3">
          <!-- Student Details Section -->
          <div class="student-details-container mb-4">
            <h5 class="mb-3"><b>Student Details</b></h5>
            <div style="max-width: 98%;"><hr style="border: 2px solid #162B5E;"></div>
            
            <div class="mt-3">
              <div class="mb-2">
                <span style="display: inline-block; width: 100px;"><strong>Name:</strong></span>
                <span>{{ student.last_name }}, {{ student.first_name }} {{ student.middle_name }}</span>
              </div>
              
              <div class="mb-2">
                <span style="display: inline-block; width: 100px;"><strong>Student ID:</strong></span>
                <span>{{ student.student_id }}</span>
              </div>
              
              <div class="mb-2">
                <span style="display: inline-block; width: 100px;"><strong>College:</strong></span>
                <span>{{ student.college }}</span>
              </div>
              
              <div class="mb-2">
                <span style="display: inline-block; width: 100px;"><strong>Course:</strong></span>
                <span>{{ student.course }}</span>
              </div>
              
              <div class="mb-2">
                <span style="display: inline-block; width: 100px;"><strong>Year Level:</strong></span>
                <span>{{ student.year_level }}</span>
              </div>
            </div>
          </div>
          
          <!-- Ticket Details Section -->
          <div class="ticket-details-container">
            <h5 class="mb-3"><b>Ticket Details</b></h5>
            <div style="max-width: 98%;"><hr style="border: 2px solid #162B5E;"></div>
            
            <div class="mt-3">
              <div class="mb-2">
                <span style="display: inline-block; width: 100px;"><strong>Reported on:</strong></span>
                <span>{{ ticket.date_created }}</span>
              </div>
              
              <div class="mb-2">
                <span style="display: inline-block; width: 100px;"><strong>Reported by:</strong></span>
                <span>{{ reported_by }}</span>
              </div>
              
              <div class="mb-2">
                <span style="display: inline-block; width: 100px; vertical-align: top;"><strong>Violation:</strong></span>
                <div style="display: inline-block;">
                  <div>{% if ticket.id_violation %}ID Violation{% endif %}</div>
                  <div>{% if ticket.dress_code_violation %}Dress Code Violation{% endif %}</div>
                  <div>{% if ticket.uniform_violation %}Uniform Violation{% endif %}</div>
                  <div>{% if ticket.id_not_claimed_violation %}ID Not Claimed{% endif %}</div>
                </div>
              </div>
              
              <div class="mb-2">
                <span style="display: inline-block; width: 100px; vertical-align: top;"><strong>Description:</strong></span>
                <span>{{ ticket.remarks }}</span>
              </div>
              
              {% if ticket.id_status != 0 %}
              <div class="mb-2">
                <span style="display: inline-block; width: 100px;"><strong>Returned by:</strong></span>
                <span>{{ ticket.id_returned_by }}</span>
              </div>
              
              <div class="mb-2">
                <span style="display: inline-block; width: 100px;"><strong>Return date:</strong></span>
                <span>{{ ticket.id_returned_date }}</span>
              </div>
              {% endif %}
            </div>
            
            <!-- ID Claimed/Unclaimed Button -->
            <div class="mt-4 text-center" style="width: 100%;">
              {% if ticket.id_status == 0 %}
                <form method="POST" action="{% url 'ts_guard:IDStatus' ticket.ticket_id %}" class="d-inline-block">
                  {% csrf_token %}
                  <input type="hidden" name="status" value="1">
                  <button type="button" class="btn btn-secondary controls-unclaimed" onclick="update_id({{ ticket.ticket_id }}, 1)"{% if ticket.ticket_status == 0 %} disabled {% endif %}>ID Unclaimed</button>
                </form>
              {% else %}
                <button type="button" class="btn btn-primary controls-claimed" disabled>ID Claimed</button>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

{% endblock %}